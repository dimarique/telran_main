# README

## Лекционное занятие №12

### Тема:

Репозитарий содержит материалы по лекционному занятию №12, посвященному работе с localStorage в JS.

### Разогрев, и повторение пройденного
1. Что выведет код:
```
const firstObj = {
   name: 'Timon',
   kind: 'Suricate',
   age: 10
}

const secondObj = firstObj;
secondObj.age = 15;
console.log( firstObj.age, secondObj.age);
```

2. Что выведет код:
```
const firstObj = {
   name: 'Timon',
   kind: 'Suricate',
   age: 10
}

const secondObj = {
   name: 'Timon',
   kind: 'Suricate',
   age: 10
}

console.log( firstObj === secondObj );
```

3. Что выведет код:
```
const firstObj = {
   name: 'Timon',
   kind: 'Suricate',
   age: 10
}

const secondObj = { ...firstObj };
secondObj.age = 15;
console.log( firstObj === secondObj );
console.log( firstObj.age, secondObj.age);
```

4. Что выведет код:
```
const timon = {
   name: 'Timon',
   kind: 'Suricate',
   friends: ['Pumba', 'Simba']
}

const newTimon = { ...timon };
newTimon.friends.push('Tukano');
console.log(timon.friends.includes('Tukano'));
```

### Мотивация использования - зачем все это нужно
Как мы знаем, все те данные, которые мы определяем в скрипте (переменные, константы, и т.д.), а также все данные, которые мы вводим на странице, не переживают обновления страницы. То есть, как только мы обновляем страницу, наша разметка формируется заново (с пустыми значениями полей ввода, или же со значениями по умолчанию), и наши скрипты выполняются по новой, с нуля.

В то же время, мы неоднократно видели, что некоторые сайты как бы "запоминают" что-то о нас. То есть, мы были на сайте, и настроили его "под себя" - например, выбрали язык и установили цветовую тему. Мы потусили на сайте, ушли оттуда, закрыли вкладку, закрыли браузер, и вернулись на сайт спустя неделю. А сайт каким-то образом сохранил наши настройки (выбранный неделю назад язык и тему).

Или другой пример. Вы долго и старательно собираете корзину товаров в интернет-магазине. И в счастливый миг, когда вы уже готовы оформить заказ - у вас "мигнул" свет, и отключился роутер. После восстановления связи, вы обновляете страницу. И если в этот момент вы увидите пустую корзину - то на этот интернет-магазин вы больше не зайдете. То есть, интернет-магазин тоже каким-то образом восстановил корзину.

Та же ситуация с данными форм. Вы долго заполняли форму, и вдруг кот прошел по клавиатуре, и нажал "обновить". Если форма будет очищена - то на этот сайт вы вряд ли когда-нибудь зайдете еще раз.

А вот еще один пример, когда вы с удивлением обнаруживаете, что если открыть интернет-магазин в разных вкладках - то корзина у них общая.

То есть, мы видим необходимость некого инструмента, который поможет нам сохранять данные клиента. Причем это нужно хранить именно на клиенте, а не на стороне сервера. Почему - подумайте сами (это к размышлению).

И вот для этого и служат хранилища на клиенте, а именно `localStorage`, `sessionStorage`, `cookies`, и еще есть `IndexedDB`, но мы будем сегодня обсуждать только первое.

### Что такое localStorage
Это инструмент, который позволяет нам (разработчикам веб-проекта), хранить какие-то данные на клиенте (в браузере клиента).  Есть ряд правил и ограничений при работе с `localStorage`, а именно:
 - размер данных, которые можно хранить - до 5Мб данных по умолчанию, но можно и больше, если поменять это в настройках браузера.
 - этими данными невозможно управлять с сервера - только через JS
 - хранилища привязаны к источнику данных - протокол + домен + порт. То есть, каждый веб-проект имеет свое хранилище, и они не пересекаются.
 - в отличие от куки, эти данные живут на клиенте, и не отправляются на сервер при каждом запросе.

### Как работать с localStorage
В `localStorage` мы храним пары "ключ-значение". То есть, можно рассматривать это как большой-пребольшой объект. Есть важный нюанс: в `localstorage`, мы можем хранить только строки. Если мы попытаемся сложить в ЛС не строку, а что-то другое, то это "что-то" будет неявно преобразовано в строку. Это вызывает определенные сложности, о которых мы поговорим сегодня и на след.занятии.

`localStorage` - это свойство глобального объекта `window`, то есть доступно нам "из коробки". Это свойство содержит ссылку на объект, который предоставляет нам следующие методы:
 - setItem(key, value) – сохранить пару ключ/значение. Если в хранилище уже есть такой ключ `key` - то его значение будет перезаписано.
 - getItem(key) – получить данные по ключу key. Если хранилище не содерджитт такого ключа - то будет возвращено `undefined`.
 - removeItem(key) – удалить данные с ключом key.
 - clear() – удалить всё.
 - key(index) – получить ключ на заданной позиции.
 - length – количество элементов в хранилище.

Обычно, для доступа к хранилищу, используют get/set/remove. Остальные методы не так востребованы.

**Добавление значения в ЛС**
Рассмотрим пример. Предположим, нам нужно сохранить в `localStorage` значение языка, выбранного пользователем при визите на наш сайт.

```
localStorage.setItem('lang', 'ru-RU');
```

То есть, мы сохраняем в хранилище КЛЮЧ `lang`, и присваиваем ему ЗНАЧЕНИЕ `ru-RU`. Мы можем убедиться в этом, если откроем консоль разработчика в браузере (F12), и найдем там вкладку "Application". В открывшейся вкладке, будет подменю `Storage`, и нас интересует раздел `Local Storage`.

**Получение значения из ЛС**
Теперь предположим, что нам нужно воспользоваться этим значением. Для этого, нам нужно каким-то образом извлечь его из хранилища. И тут нам поможет `getItem`.

```
const userSelectedLang = localStorage.getItem('lang'); // 'ru-RU'
```

Таким образом, метод `getItem` принимает в аргументе ключ, и возвращает из хранилища значение, которое соответствует этому ключу.

**Удаление значения из ЛС**
Иногда, нам нужно удалить значение из ЛС. Например, пользователь отправил форму, или оформил заказ - то есть, корзина уже не нужна. Для этого нам поможет метод `removeItem`. Он принимает в аргументе ключ, и удаляет из ЛС этот ключ и соответствующее ему значение.

```
localStorage.setItem('theme', 'light'); // запоминаем в ЛС тему, которую выбрал пользователь
console.log( localStorage.getItem('theme') ); // light
localStorage.removeItem('theme'); // удаляем из ЛС значение
console.log( localStorage.getItem('theme') ); // undefined - ЛС уже не содержит такой ключ
```

**Очистка всего ЛС**
Такое тоже иногда бывает нужно, если, например, мы считаем сессию скомпрометированной, или не валидной, и нам нужно очистить все (в т.ч. и у клиента). И тут нам приходит на помощь `clear`.

```
localStorage.clear(); // удалить из ЛС все, что там есть
```

**Закрепим практикой**
1. Положить в ЛС ключ `test` со значением `simlpeValue`.
2. Извлечь из ЛС значение, соответствующее ключу `test`, и вывести его в консоль.
3. Положить в ЛС ключ `myNumber`, со значением 10.
4. Извлечь из ЛС значение, соответствующее ключу `myNumber`, и вывести в консоль результат его сложения с числом 15. Ожидаемый результат 25.
5. Удалить из ЛС ключ `test`.
6. Очистить ЛС.

**Практические примеры**
1. Давайте совместно рассмотрим простой практический пример. Реализуем кнопку-переключатель, которая будет имитировать включение/выключение света.
2. Реализовать запоминание времени первого посещения сайта, и вывод его в консоль. То есть, на событие загрузки документа (`window.onload`, или добавить обработчик события `DOMContentLoaded`) добавить обработчик, который:
 - проверит наличие в localStorage ключа `firstEnter`.
 - если его нет - запомнит в localStorage значение текущего времени (использовать конструкцию `let firstEnter = Date.now();`), с ключом `firstEnter`.
 - если такой ключ есть - вывести его в консоль.
3. Реализовать сохранение значения инпута в localStorage, а именно:
 - средствами JS добавить в `div.mainContainer`, инпут.
 - на инпут, на событие потери фокуса, добавить обработчик, который сохранит в localStorage значение инпута (использовать ключ inputValue)
 - на событие загрузки документа, добавить обработчик, который проверит наличие в localStorage ключа inputValue. Если такой имеется - то его значение записать в инпут.
4. Верстка формы обратной связи. От нас требуется с помощью JS (методами работы с DOM), создать и добавить на страницу форму обратной связи. Предполагается, что форма имеет следующие поля:
   - фамилия
   - имя
   - емейл
   - телефон
   - кнопка "Отправить"
   - кнопка "Отмена"
5. Обеспечение сохранения имени пользователя при обновлении страницы, и при показе формы, если значение указано - заполняем соответствующий инпут.
6. Обеспечение сохранения данных полей формы при обновлении страницы, и заполнение значениями при показе формы.
7. Обеспечение очистки данных формы при нажатии "Отмена" - т.е. если пользователь нажал "Отмена", то очищаем localStorage

### Полезные ссылки
 - Официальная (документация)[https://developer.mozilla.org/ru/docs/Web/API/Window/localStorage] про localStorage
 - (localStorage)[https://learn.javascript.ru/localstorage] - в учебнике.