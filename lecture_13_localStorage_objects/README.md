# README

## Лекционное занятие №10

### Тема:

Репозитарий содержит материалы по лекционному занятию №10, посвященному продолжению работы с localStorage в JS.

### Мотивация использования - зачем добавлять в ЛС не-примитивы
На прошлом занятии, мы рассматривали работу с `localStorage`. Было сказано, что ЛС умеет хранить только строки - то есть вроде бы, объект/массив туда сложить не получится. Или все же получится? Попробуем разобраться.

Главный вопрос, на который следует ответить вначале - а надо ли нам вообще запихивать в ЛС объекты/массивы? Ответ - безусловно, надо! Возвращаясь к примеру предыдущего занятия, рассмотрим вариант с хранением корзины товаров интернет-магазина. Как мы ее будем хранить без объекта? Да, это реально, но удобство работы с таким кодом мягко говоря не будет впечатлять. Поэтому, объекты/массивы таки надо хранить в ЛС.

Для начала, попробуем просто сложить в ЛС объект.

```
const obj = {
   name: 'Timon',
   type: 'Suricate'
}

localStorage.setItem('timon', obj);

console.log(localStorage.getItem('timon'));
```

В консоли мы получили отнюдь не наш объект - а строку [object Object]. Почему так? Потому что, как мы помним, ЛС умеет работать только со строками. Если мы пытаемся положить в ЛС что-то, что строкой не является - то JavaScript сделает неявное преобразование типов, то есть преобразует в строку. Такое преобразование объектов - это поведение по умолчанию, т.е. JS преобразовывает объекты в строки именно таким образом. Такое преобразование необратимое - то есть получить исходный объект у нас уже не получится.

Вывод - нам не годится такое преобразование. Нужно такое преобразование, которое будет обратимым. То есть, из получившейся строки потом можно будет получить исходный объект.

**Формат JSON**
Формат JSON (JavaScript Object Notation) - это текстовый формат обмена данными, основанный на JS (неожиданно, правда?). Этот формат позволяет представлять данные в виде объекта, который содержит пары "ключ-значение". В роли значений, могут выступать строки, числа, логические значения, массивы, и другие объекты. Глубина вложенности не ограничена.

Ниже приведен пример записи данных объекта в JSON
```
{
   "name" : "Timon",
   "type" : "Suricate",
   "age"  : 3,
   "skills" : ["jump", "run", "swim"],
   "address" : {
      "city" : "Jungle",
      "street" : "1st baobab",
      "house" : 5
   }
}
```

То есть, мы видим, что есть некоторые отличия от JS (например, все ключи берутся в кавычки), но не особо существенные.

JS умеет работать с JSON из коробки, то есть ему не нужны никакие сторонние библиотеки.

**Преобразование в/из JSON**
Для работы с этим форматом, JS предоставляет нам методы:
 - `const stringified = JSON.stringify(jsObject)` - этот метод преобразует обычный JS-объект в строку, которая будет содержать представление этого объекта в формате JSON
 - `const parsed = JSON.parse(stringified)` - это обратный метод, который разберет строку в формате JSON, и (если получится) сделает из нее обычный JS-объект.

Важный момент: если мы выполнили JSON.stringify для объекта, а затем вызвали для результата метод JSON.parse, то новый объект НИКАК НЕ СВЯЗАН с оригинальным объектом. Здесь мы получаем глубокую копию.

Точно так же, все работает для массивов (т.к. как мы помним, под капотом в JS массивы являются объектами).

```
const array = ["Timon", "Pumba", "Simba"];
const stringifiedArray = JSON.stringify(array);

const parsedArray = JSON.parse(stringifiedArray);
console.log(array === parsedArray); // false
```

Аналогично, все работает для объектов.

Таким образом, мы делаем вывод, что JS предоставляет нам возможности для нормальной работы в форматом JSON "из коробки". С помощью этого, мы можем преобразовывать объекты и массивы в строку формата JSON, и это преобразование обратимое - то есть, мы можем потом из этой строки восстановить объект/массив.

**Хранение не-примитивов в localStorage**
Теперь перейдем к тому, ради чего мы обсуждали формат JSON. Вспомним о том, что в `localStorage` мы можем хранить только строки. Теперь, с учетом того что мы уже умеем, мы можем там хранить и объекты/массивы. Для того, чтобы сложить в ЛС массив/объект, мы сначала преобразуем его в строку в формате JSON (иногда говорят "сериализуем"), и положим получившуюся строку в ЛС. А когда нам понадобится поработать с этим объектом, мы извлечем это значение из ЛС, преобразуем обратно в объект/массив (или "десериализуем"), и можем спокойно с этим работать.

Пример:
```
const userObj = {
   login: 'UserLogin',
   status: 'active',
   settings: {
      lang: 'ru-RU',
      theme: 'light'
   }
}

// Преобразуем объект в строку в формате JSON
const serialized = JSON.stringify(userObj);

// Сложим ее в ЛС
localStorage.setItem('user', serialized);

// ...

// Извлекаем данные из ЛС
const userDataString = localStorage.getItem('user');
console.log(userDataString); // выведет строку в формате JSON
console.log(typeof userDataString); // string
const deserialized = JSON.parse(userDataString);
console.log(deserialized); // выведет объект
console.log(typeof deserialized); // object
```

**Закрепим практикой**

1. Пристрелочная задача. Освежаем в памяти сериализацию/десериализацию объектов, и обработчики событий. В файле `main.js` есть объект `testObject`, который содержит поля. Задача - его сериализовать и записать в `localStorage`, с ключом `testObject`.
2. В разметке есть кнопка `saveTestBtn`, у нее есть ID. Добавляем обработчик события на эту кнопку. При клике нужно:
 - достать из `localStorage` значение по ключу `testObject`.
 - десериализовать его
 - вывести результат десериализации в консоль
 - вывести в консоль значение свойства `name` десериализованного объекта.
3. Обеспечить сохранение данных всех инпутов в блоке "Блок для второй задачи". У блока есть ID: `inputsBlock`. В блоке есть несколько инпутов. У каждого инпута есть свой ID.
 - Написать функцию `saveInputsData`, которая будет запоминать все значения инпутов в `localStorage`. Функция должна создать объект, в который запишет значения всех инпутов в блоке, при этом в качестве ключей используем идентификаторы (ID). И этот объект записать в `localStorage`. Эта функция должна вызываться при клике на кнопку "Save Inputs".
  - Далее написать функцию `restoreInputsData` - она должна восстановить значения в инпутах из `localStorage`. Эта функция должна вызываться при клике на кнопку "Restore Inputs".
  - написать функцию `clearInputsData` - очистка объекта с данными инпутов в `localStorage`. Вызывается при клике на кнопку "Clear Inputs".
4. Работаем с DOM, и готовим почву для следующей задачи. Нам нужно написать функцию, которая отрендерит список товаров. Список товаров - это массив `products`. Он содержит данные товаров. Нам нужно пройтись по массиву товаров, и отрисовать их. Товары должны размещаться в контейнере (`div.productsContainer`).
 - товары рендерим в виде карточек. Карточка - это `div.productCard`.
 - у товара есть адрес изображения. Рендерим его как изображение (`img.productImg`).
 - у товара есть название (`h3`), заполняем его свойством `name` объекта с данными товара
 - У товара есть категория, цена. Их отображаем как параграфы.
 - каждая карточка товара должна содержать две кнопки (`button.button`). Текст первой - "В корзину", текст второй - "Убрать". Первой кнопке добавить класс `addToCartBtn`, второй - `removeFromCartBtn`
5. Нужно реализовать функциональность "Корзины". Корзина у нас будет храниться в виде JS-объекта, и при этом дублироваться в `localStorage` в виде объекта. Использовать ключ `basketInstance`.
 - создаем объект `basket` - в нем будем держать данные нашей корзины. В качестве ключей используем ID товара (`id`)
 - в функцию рендеринга списка товаров, надо внести изменения - реализовать обработчики. При клике на "Добавить" - в объекте basket, нужно увеличить на 1 количество этого товара. При клике на "Удалить" - соответственно, уменьшить на 1. Следить чтобы не было отрицательных значений. После этого, изменившийся объект нужно сохранить в `localStorage`.
 - под контейнер с товарами (`div.productContainer`) добавить кнопку "Показать корзину".
 - при клике на кнопку "Показать корзину", вывести в консоль объект basket и значение из `localStorage`
 - добавить кнопку "Очистить корзину" возле кнопки "Показать корзину"
 - добавить обработчик на кнопку очистки корзины - удалять объект `basketInstance` из `localStorage`


### Полезные ссылки
 - Описание формата (JSON)[https://habr.com/ru/articles/554274/]
 - Официальная (документация)[https://developer.mozilla.org/ru/docs/Web/API/Window/localStorage] про localStorage
 - (localStorage)[https://learn.javascript.ru/localstorage] - в учебнике.